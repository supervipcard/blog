<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>项晨个人博客</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/nprogress.css">
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css">
{#    <link rel="stylesheet" type="text/css" href="/static/js/kindeditor/plugins/code/prettify.css"/>#}
    <script src="/static/js/jquery-2.1.4.min.js"></script>
    <script src="/static/js/nprogress.js"></script>
{#    <script type="text/javascript" src="/static/js/kindeditor/plugins/code/prettify.js"></script>#}
{#    <script type="text/javascript">#}
{#        $(function(){ prettyPrint(); });#}
{#    </script>#}
    <!--[if gte IE 9]>
      <script src="/static/js/jquery-1.11.1.min.js" type="text/javascript"></script>
      <script src="/static/js/html5shiv.min.js" type="text/javascript"></script>
      <script src="/static/js/respond.min.js" type="text/javascript"></script>
      <script src="/static/js/selectivizr-min.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if lt IE 9]>
      <script>window.location.href='upgrade-browser.html';</script>
    <![endif]-->
</head>
<body class="user-select single">
    {% include 'header-block.html' %}
    <section class="container">
        <div class="content-wrap">
            <div class="content">
                <header class="article-header">
                <h1 class="article-title">{{ article.title }}</h1>
                <div class="article-meta">
                    <span class="item article-meta-time"><time class="time" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="发表时间：{{ article.time | date:"Y-m-d" }}"><i class="glyphicon glyphicon-time"></i> {{ article.time | date:"Y-m-d" }}</time></span>
                    <span class="item article-meta-category" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="主标签：{{ article.tag.first }}"><i class="glyphicon glyphicon-list"></i> {{ article.tag.first }}</span>
                    <span class="item article-meta-views" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="浏览量：{{ article.read_count }}"><i class="glyphicon glyphicon-eye-open"></i> {{ article.read_count }}</span>
                    <span class="item article-meta-comment" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="评论量：{{ article.comment_count }}"><i class="glyphicon glyphicon-comment"></i> {{ article.comment_count }}</span>
                </div>
                </header>
                <article class="article-content">
                    {{article.article|safe}}
                </article>
                <div class="article-tags">标签：
                {% for cell in article.tag.all %}
                    <a href="{% url 'tags' tag=cell.name %}" rel="tag" >{{ cell.name }}</a>
                {% endfor %}
                </div>
                <div class="article-handle">
                    <div class="article-share">
                        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
                    </div>
                    <a href="javascript:void(0)" class="article-praise" title="点个赞"><i class="glyphicon glyphicon-thumbs-up"></i> {{ article.praise_count }}</a>
                </div>
                <div class="relates">
                    <div class="title">
                        <h3>相关推荐</h3>
                    </div>
                    <ul>
                    {% for cell in related_articles %}
                        <li><a href="{% url 'details' %}?id={{ cell.id }}" title="" >{{ cell.title }}</a></li>
                    {% endfor %}
                    </ul>
                </div>
                <div class="title" id="comment">
                    <h3>评论</h3>
                </div>
                <div id="respond">
                    <form id="comment-form" method="POST">
                        <div class="comment">
                            <input name="username" id="username" class="form-control" size="22" placeholder="昵称（必填）" maxlength="15" autocomplete="off" tabindex="1" type="text">
                            <input name="email" id="email" class="form-control" size="22" placeholder="邮箱（必填）" maxlength="58" autocomplete="off" tabindex="2" type="text">
                            <input name="website" id="website" class="form-control" size="22" placeholder="网站（选填）" maxlength="58" autocomplete="off" tabindex="3" type="text">
                            <div class="comment-box">
                                <textarea placeholder="评论（必填）" name="comment-textarea" id="comment-textarea" cols="100%" rows="3" tabindex="4"></textarea>
                                <div class="comment-ctrl">
                                    <div class="comment-prompt" style="display: none;"><i class="fa fa-spin fa-circle-o-notch"></i><span class="comment-prompt-text"> 评论正在提交中...请稍后</span></div>
                                    <button type="submit" name="comment-submit" id="comment-submit" tabindex="5">评论</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="postcomments">
                    <ol id="comment_list" class="commentlist">
                        {% for cell in article.comment_content.all reversed %}
                            <li class="comment-content"><span class="comment-f">#{{ forloop.revcounter }}</span>
                                <div class="comment-main"><p>
                                    {% if cell.website %}
                                        <a class="address" href="{{ cell.website }}" rel="nofollow" target="_blank">{{ cell.username }}</a>
                                    {% else %}
                                        <span class="username">{{ cell.username }}</span>
                                    {% endif %}
                                    <span class="time">{{ cell.time | date:"Y-m-d H:i" }}</span><br>{{ cell.content }}</p>
                                    {% if cell.reply %}
                                        <p class="comment-reply"><span class="username">【站长回复】</span><span class="time">{{ cell.reply_time| date:"Y-m-d H:i" }}</span><br>{{ cell.reply }}</p>
                                    {% endif %}
                                </div>

                            </li>
                        {% endfor %}
                    </ol>
                </div>
            </div>
        </div>
        {% include 'aside-block.html' %}
    </section>
    {% include 'footer-block.html' %}
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.ias.js"></script>
    <script src="/static/js/scripts.js"></script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    <script>
        $('.article-praise').on("click", (function(){
            $.ajax({
                type:"POST",
                data: {id: {{ article.id }}, action: 'praise'},
                url: "{% url 'praise-ajax' %}",
                dataType: "json",
                success: function(result){
                    if (result['success'] === true) {
                        alert("感谢支持！");
                        $(".article-praise").html('<i class="glyphicon glyphicon-thumbs-up"></i> ' + result['count']);
                    }
                    else{
                        alert("您已经支持过了！");
                    }
                },
                error: function(){
                    alert("点赞失败！");
                }
            });
            return false
        }));
        $("#comment-form").submit(function () {
            var commentUsername = $("#username");
            var commentEmail = $("#email");
            var commentWebsite = $("#website");
            var commentContent = $("#comment-textarea");
            var commentButton = $("#comment-submit");
            var promptBox = $('.comment-prompt');

            promptBox.fadeIn(300);
            if (commentUsername.val() === '') {
                promptBox.html('<i class="glyphicon glyphicon-remove"></i><span class="comment-prompt-text"> 请填入您的昵称</span>');
                return false;
            }
            else if (commentEmail.val() === '') {
                promptBox.html('<i class="glyphicon glyphicon-remove"></i><span class="comment-prompt-text"> 请填入您的邮箱</span>');
                return false;
            }
            else if (commentContent.val() === '') {
                promptBox.html('<i class="glyphicon glyphicon-remove"></i><span class="comment-prompt-text"> 请输入您的评论</span>');
                return false;
            }
            commentButton.attr('disabled', true);
            commentButton.addClass('disabled');
            $.ajax({
                type: "POST",
                url: "{% url 'comment-ajax' %}",
                data: {id: {{ article.id }}, username: commentUsername.val(), email: commentEmail.val(), website: commentWebsite.val(), content: commentContent.val()},
                dataType: "json",
                cache: false,
                success: function (result) {
                    promptBox.html('<i class="glyphicon glyphicon-ok"></i><span class="comment-prompt-text"> 评论成功</span>');
                    promptBox.delay(3000).fadeOut(300);
                    commentContent.val(null);
                    commentButton.attr('disabled', false);
                    commentButton.removeClass('disabled');
                },
                error: function() {
                    promptBox.html('<i class="glyphicon glyphicon-remove"></i><span class="comment-prompt-text"> 评论失败</span>');
                    promptBox.delay(3000).fadeOut(300);
                    commentContent.val(null);
                    commentButton.attr('disabled', false);
                    commentButton.removeClass('disabled');
                }
            });
            return false
        });
    </script>
</body>
</html>
